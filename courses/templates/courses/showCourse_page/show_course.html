{% extends 'base/index.html' %}
{% load static %}


{% block keyWord %}
    {{ course.keyWord }}
{% endblock %}


{% block description %}
    {{ course.CourseDescription | safe }}
{% endblock %}


{% block title %}
    {{ title }}
{% endblock %}




{% block context %}
    <section class="ftco-section ftco-degree-bg">
        <div class="container">
            <div class="row" style="flex-direction: row-reverse;">
                <div class="col-md-8 ftco-animate right-rm">
                    <p>
                        <img src="{{ course.CourseImage.url }}" alt="{{ course.CourseName }}" class="img-fluid">
                    </p>
                    <br>
                    <h1 class="mb-3">{{ course.CourseName | safe }}</h1>
                    <h2 class="mb-3 mt-5">توضیحات دوره</h2>
                    <p>{{ course.CourseDescription | safe }}</p>


                    <div class="pt-5 mt-5">
                        <div id="listCources">
                            <ul>
                                <li>
                                    <span>0</span><div><span>معرفی دوره</span><span style="margin: 0 25px;"></span><a href="{{ Introduction_Video.video.url }}" class="mdi mdi-download"></a></div>
                                </li>
                                {% if status %}
                                    {% for v in videos %}
                                        <li>
                                            <span>{{ forloop.counter }}</span><div><span>{{ v.title }}</span><span style="margin: 0 25px;"></span><a href="{{ v.video.url }}" class="mdi mdi-download"></a></div>
                                        </li>
                                    {% endfor %}
                                {% else %}
                                    <h2 style='text-align: center;'>برای دسترسی به دوره ابتدا دوره را خریداری کنید</h2>
                                {% endif %}
                                
                            </ul>
                        </div>

                        <style>
                            #listCources {
                                /* border: 1px solid #000; */
                                border-radius: 10px;
                                box-shadow: 0 0 20px #ccc;
                                padding: 20px;
                            }
                            #listCources ul {
                                width: 100%;
                                list-style: none;
                                display: flex;
                                flex-direction: column;
                            }
                            #listCources ul li {
                                margin-bottom: 25px;
                                display: flex;
                                direction: rtl;
                                text-align: right;
                                flex-direction: row;
                                justify-content: right;
                                align-items: center;
                            }
                            #listCources ul li > span {
                                width: 55px;
                                height: 50px;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                border: 6px solid #004085;
                                border-radius: 50px;
                                background-color: #167ce9;
                                color: #fff;
                                line-height: 0;
                            }
                            #listCources ul li > div {
                                width: 100%;
                                /* height: 50px; */
                                display: flex;
                                justify-content: space-between;
                                padding: 15px;
                                align-items: center;
                                margin-right: 15px;
                                border-bottom: 1px solid #888;
                                flex-wrap: wrap;
                            }
                            #listCources ul li > div > a {
                                width: 50px;
                                height: 50px;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                /* border: 1px solid #000; */
                                border-radius: 10px;
                                background-color: #167ce9;
                                color: #fff;
                                padding: 15px 20px;
                                font-size: 1.5rem;
                                margin: 10px 0;
                            }
                        </style>

                    </div>

                </div> <!-- .col-md-8 -->
               

                
                                    <div class="col-md-4 sidebar ftco-animate">
                    <div id="listInfoCourse" style="box-shadow: 0 0 20px #ccc;padding: 20px;border-radius: 10px">
                        <span class="course-price" style="margin-top: 10px;">

                            <i class="zmdi zmdi-money"></i>
     قیمت این دوره :                                    <span class="price-amount"> </span>
                                        <span class="price-amount"><i> {{ course.CoursePrice  }} </i> تومان </span>

                        </span>
                            <hr style="background-color:#000">
                        <ul>
                            {#                            <li><i class="mdi mdi-account-circle-outline"></i> مدرس دوره :#}
                            {#                                <span> سجاد میرشبی بایگی </span> <a#}
                            {#                                        rel="author" href="/masters/sajjadmirshabi"> ( رزومه ) </a></li>#}
                            <li class="notShowInRecording"><i class="mdi mdi-video-outline"></i> تعداد ویدیوها : {{ videos_count }} ویدیو </li>
                            <li class="notShowInRecording"><i class="mdi mdi-timer-outline"></i> مدت زمان دوره : {{ course.CourseDuration }} </li>
                            <li><i class="mdi mdi-layers-outline"></i> سطح دوره : {{ course.CourseLevel }} </li>
                            <li><i class="mdi mdi-information-outline"></i> وضعیت دوره :

                                    {% if  course.CourseStatus  %}
                                         به اتمام رسیده 
                                    {% else %}
                                         درحال برگزاری 
                                    {% endif %}
                            </li>
                            <li class="notShowInRecording"><i class="mdi mdi-school-outline"></i> تعداد دانشجویان : {{ course.students }} دانشجو </li>
                            {#                            <li class="notShowInRecording"><i class="mdi mdi-account-circle-outline notShowInRecording"></i>#}
                            {#                                   تاریخ آخرین بروزرسانی : <span> 1400/06/01 </span></li>#}
                        </ul>
                        {% if status %}

                        {% else %}
                            <a class="btnPriceCourse" style="cursor: pointer;"
                            onclick="addorder()">ثبتـــ نام در این دوره </a>

                        {% endif %}

                    </div>
              


                    <style>
                        #listInfoCourse {
                            direction: rtl;
                            display: flex;
                            flex-direction: column;
                        }

                        #listInfoCourse ul {
                            list-style-type: none;
                        }

                        #listInfoCourse ul li {
                            display: flex;
                            align-items: center;
                        }

                        #listInfoCourse ul li i.mdi {
                            font-size: 2rem;
                            margin-left: 10px;
                            line-height: 2rem;
                        }

                        .course-price {
                            text-align: center;
                            align-self: center;
                            margin-bottom: 20px;
                            font-size: 1.2rem;
                        }
                        .btnPriceCourse {
                            margin-top: 5px;
                            padding: 15px;
                            text-align: center;
                            border: 2px solid #167ce9;
                            border-radius: 50px;
                        }
                        .btnPriceCourse:hover {
                            background-color: #167ce9;
                            color: #fff;
                        }
                    </style>

                    {% csrf_token %}
                </div>

            </div>

        </div>
        </div>
        <div id="alertRM">

        </div>

        <script>
            function addorder() {
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                const http = new XMLHttpRequest();
                let url = '{% url "api:addCourses" %}';
                let params = `id={{ course.id }}`;
                http.open('POST', url, true);

//Send the proper header information along with the request
                http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                http.setRequestHeader('X-CSRFToken', csrftoken);

                http.onreadystatechange = function () {//Call a function when the state changes.
                    if (http.readyState === 4 && http.status === 200) {
                        updateCart();
                        document.querySelector('#alertRM').innerHTML =`
                        <div class="row" style="margin-right: 10px">
                            <div class="alert success-alert col-md-4" style="right: 0;width: 40%;flex-direction: row-reverse;">
                                <h3>دوره به سبد خرید اضافه شد</h3>
                                <a class="close closeRM" style="width: 40px;" onclick="funclose()">&times;</a>
                            </div>
                        </div>
                        `;
                    } else {
                        document.querySelector('#alertRM').innerHTML = `
                        <div class="row" style="margin-right: 10px;">
                            <div class="alert danger-alert col-md-4" style="right: 0;flex-direction: row-reverse;">
                                <h3>دوره به سبد خرید  اضافه شده </h3>
                                <a class="close" onclick="funclose()" style="width: 40px;">&times;</a>
                            </div>
                        </div>
                        `;
                    }
                }
                http.onerror = function(){
                    document.querySelector('#alertRM').innerHTML = `
                        <div class="row" style="margin-right: 10px;">
                            <div class="alert danger-alert col-md-4" style="right: 0;flex-direction: row-reverse;">
                                <h3>دوره به سبد خرید  اضافه شده </h3>
                                <a class="close" onclick="funclose()" style="width: 40px;">&times;</a>
                            </div>
                        </div>
                        `;
                }
                http.send(params);
            }
            //document.getElementsByClassName('closeRM')[0].addEventListener('click',funclose);
            function funclose(){
                document.querySelector('#alertRM').innerHTML='';
            }
        </script>
    </section> <!-- .section -->
{% endblock %}
